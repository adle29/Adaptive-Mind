function getVideoString(e){var t=e;var n=t.indexOf("src=");t=t.substring(n,t.length);n=t.indexOf("//");t=t.substring(n+2,t.length);n=t.indexOf('"');t=t.substring(0,n);return t}define(["AdaptiveMindView","text!templates/vinbookDoc.html","text!templates/vinbookDocIphone.html","models/Vinbook","models/EntriesCollection","modules/img","modules/vid","modules/txt"],function(e,t,n,r,i,s,o,u){var a=1,f=0,l="";var c;var h="";var p;var d=e.extend({el:$("#content"),defaults:{entries:"",entryColl:""},initialize:function(){$("div.navbar.navbar-inverse").hide();this.gettingVinbook()},events:{"click #IMG":"showEntryImg","click #VID":"showEntryVid","click #TXT":"showEntryTxt","click #close":"closeEntry","click #sub":"mediaEntry","click #search":"mediaEntryPic","click #more":"more","click #save":"saveDoc","click #bold":"bold","click #list":"list","click #link":"link","click #video":"video"},gettingVinbook:function(){var e=this;h=this;$("#content").html("<img class='ajax-loader' src='https://www.amrms.com/ssl/iftafoundation/bluepay/Images/Loading_Animation.gif'>");$.get("/vinbook",{vinId:this.id},function(t){e.gettingVinbook2(t)})},gettingVinbook2:function(e){var t=e[0].vinbooks;var n=this;for(var r=0;r<t.length;r++){p=t[r];if(p._id==n.id){n.render(e[0]._id,p);n.renderEntries(p.Entries);return}}},showEntryImg:function(){$("#myModal").modal()},showEntryVid:function(){$("#txtUrl").prop("placeholder","Vid");$("#mediaForm").toggle(function(){console.log("pancakes")})},showEntryTxt:function(){this.mediaEntry("yes")},closeEntry:function(){$("#mediaForm").hide()},mediaEntry:function(e){var t=$("input[name=txtUrl]").val();var n=e=="yes"?"":$("input[name=txtUrl]").attr("placeholder");var r;if(n=="Img"){r=new s;r.set({Ourl:t,ids:Math.random().toString(36).substring(7)})}else if(n=="Vid"){r=new o({Ourl:t,ids:Math.random().toString(36).substring(7)})}else{console.log("text",e,n);r=new u}this.entries.add(r);r.render()},mediaEntryPic:function(){var e=this;c=new google.search.ImageSearch;c.setResultSetSize(google.search.Search.LARGE_RESULTSET);c.setSearchCompleteCallback(null,e.imgComplete,null);c.execute($("#request").val())},more:function(){c.gotoPage(a);a++},imgComplete:function(){var e=document.getElementById("image-content");$("#image-content").empty();e.innerHTML="";if(c.results&&c.results.length>0){var t=c.results;console.log("yes5",c.results.length);for(var n=0;n<t.length;n++){var r=t[n];var i="<img class='imgGoogle' src='"+r.unescapedUrl+"' id='"+n+"''   />";$("#image-content").append(i)}$(".imgGoogle").click(function(){console.log(this);l=$(this).attr("src");h.mediaEntryImg(l)})}},work:function(e){this.mediaEntryImg(e)},mediaEntryImg:function(e){var t=new s;t.set({y:$(window).scrollTop()/5,Ourl:e,ids:Math.random().toString(36).substring(7)});t.render();this.entries.add(t);$("#closeModal").trigger("click")},renderEntries:function(e){this.entries=new i;if(e!=0){var t=e[0];for(var n=0;n<t.length;n++){var r=t[n];if(r.module=="img"){var a=new s(r);a.render(this.options.notYou);this.entries.add(a)}else if(r.module=="vid"){console.log("VIDEO YEAH");var a=new o(r);a.render(this.options.notYou);this.entries.add(a)}else{var a=new u(r);a.render(this.options.notYou);this.entries.add(a)}}}},saveDoc:function(){$("#save").removeClass();$("#save").addClass("btn btn-danger");$.post("/vinbook/:id",{ids:this.id,AccountId:this.model.me,entries:this.entries.toJSON()},function(e){if(!e.error){setTimeout(function(){$("#save").removeClass();$("#save").addClass("btn btn-success")},1500)}}).error(function(){console.log("POST REQUEST - UPDATE - ERROR")})},bold:function(){console.log("here");document.execCommand("bold",false)},list:function(){console.log("here");document.execCommand("insertUnorderedList",false)},link:function(){console.log("here");var e=prompt("Please enter the link:","Link");document.execCommand("CreateLink",false,e)},video:function(){var e=prompt("Please enter the video:","Video");e=getVideoString(e);var t=new o;t.set({y:$(window).scrollTop()/5,Ourl:e,ids:Math.random().toString(36).substring(7)});t.render();this.entries.add(t)},render:function(e,r){var i=$(window).width();if(r!=null){if(i<600||this.model.me!=e){this.$el.html(_.template(n,r));this.options.notYou=false;console.log("not you",this.options.notYou,this.model.me)}else{this.$el.html(_.template(t,r));this.options.notYou=true}}}});return d})